
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>分布式锁及其实现方式 | 杨阳的博客</title>
<meta name="description" content="记录下">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://yangyng.github.io/favicon.ico?v=1561556334533">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://yangyng.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://yangyng.github.io">
        <img class="avatar" src="https://yangyng.github.io/images/avatar.png?v=1561556334533" alt="" width="32px" height="32px">
      </a>
      <a href="https://yangyng.github.io">
        <h1 class="site-title">杨阳的博客</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/" class="menu purple-link">
            首页
          </a>
        
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/tags" class="menu purple-link">
            标签
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
            <div class="feature-container" style="background-image: url('https://yangyng.github.io/post-images/UzPIBHidO.jpg')">
            </div>
          
          <h2 class="post-title">分布式锁及其实现方式</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2019-06-17</span>
            
          </div>
          <div class="post-content">
            <h3 id="分布式锁及相关">分布式锁及相关</h3>
<blockquote>
<p>分布式锁的概念 =&gt; 是控制分布式系统之间同步访问共享资源的一种方式</p>
<p>使用场景 =&gt; 在分布式系统中,常常需要协调他们的动作,如果不同的系统或是同一个系统能够的不同主机之间共享了一个或 一组资源,那么访问这些资源的时候,往往需要互斥来防止彼此干扰来保证一致性,在这种情况下,便需要使用到分布式锁</p>
<p>保证可用性 =&gt;</p>
<ul>
<li>==互斥性==,在任意时刻,只有一个客户端能够持有该锁</li>
<li>==不会死锁==(死锁 =&gt; 当两个以上的请求方,双方都在等待对方释放锁,以获取系统资源,但没有一方提前退出时,就成为死锁 ==两个人过独木桥==)</li>
<li>==容错性== 有一个客户端在持有锁的期间崩溃而没有主动解锁,也能保证后续其它客户端能使用该锁</li>
</ul>
</blockquote>
<h4 id="基于redis的分布式锁">基于REDIS的分布式锁</h4>
<h5 id="redission-简介">Redission 简介</h5>
<blockquote>
<p>Redis客户端在基于NIO的Netty框架上,充分的利用了Redis键值数据库提供的一系列优势,在Java实现工具包中常用接口的基础上,未使用这提供了一系列具有分布式特性的常用工具类</p>
<p>支持Redis 单实例 哨兵 Cluster master-slave 等各种部署架构</p>
</blockquote>
<h6 id="1-redis使用lua脚本的-好处">1. redis使用lua脚本的 好处</h6>
<ol>
<li>原子性 Lua脚本是做为一个整体执行的,所以中间不会被其它命令插入</li>
<li>减少网络开销 可以把多条命令一次性打包</li>
</ol>
<h6 id="2-基本思路">2. 基本思路</h6>
<ol>
<li>锁ID作为redis的key value为hash结构 hash的filed为获得锁的客户端ID value为加锁次数</li>
<li>成功新建写入锁的Key对应的Hash的客户端占用锁</li>
<li>==代码待补充==</li>
<li>客户端不断循环重试执行Lua脚本,知道获得锁</li>
<li>锁互斥机制 Lua脚本保证并发情况下加锁的原子性,中间不会被其他命令插入</li>
</ol>
<h6 id="3-可重入锁机制">3. 可重入锁机制</h6>
<blockquote>
<p>如果以获取客户端线程再次获取锁,该客户端线程的锁的次数+1</p>
</blockquote>
<h6 id="4-释放锁机制">4. 释放锁机制</h6>
<p>该客户端的锁的次数-1
如果发现加锁次数是0了,说明这个客户端已经不在持有锁了</p>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://yangyng.github.io/post/YFjckJCA7">
              <h3 class="post-title">
                下一篇：Mysql Linux 环境下 使用Docker安装
              </h3>
            </a>
          </div>
          
      </div>

      

      <div class="site-footer">
  <div class="slogan">记录下</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://yangyng.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
